<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.2">
<title>Hystrix Examples&#8201;&#8212;&#8201;and a little bit more</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400">
<link rel="stylesheet" href="css//asciidoctor.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css">
<link rel="stylesheet" href="css//coderay-asciidoctor.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Hystrix Examples&#8201;&#8212;&#8201;and a little bit more</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_hystrix_make_your_application_resilient">1. Hystrix: Make your application resilient</a>
<ul class="sectlevel2">
<li><a href="#_build_your_application_to_handle_the_failure_of_external_services">1.1. Build your application to handle the failure of external services</a></li>
<li><a href="#_what_hystrix_has_built_in_ready_to_use">1.2. What Hystrix has built in ready-to-use</a></li>
<li><a href="#_hystrix_at_work">1.3. Hystrix at work</a></li>
</ul>
</li>
<li><a href="#_prerequisites_for_this_tutorial">2. Prerequisites for this tutorial</a>
<ul class="sectlevel2">
<li><a href="#_java_sdk_installed">2.1. Java SDK installed</a></li>
<li><a href="#_internet_connection_for_additional_downloads">2.2. Internet Connection for additional downloads</a></li>
<li><a href="#_proxy_settings">2.3. Proxy settings</a></li>
</ul>
</li>
<li><a href="#_scenario_to_challenge_hystrix_external_bank_validation">3. Scenario to challenge Hystrix: External Bank validation</a>
<ul class="sectlevel2">
<li><a href="#_iban_and_bic_validations">3.1. IBAN and BIC validations</a></li>
<li><a href="#_simulating_an_external_iban_bic_validation_service">3.2. Simulating an external IBAN/BIC validation service</a></li>
</ul>
</li>
<li><a href="#_writing_a_real_application_with_jax_rs">4. Writing a real application with JAX-RS</a>
<ul class="sectlevel2">
<li><a href="#_jax_rs_as_a_standard_for_enterprise_restful_web_application">4.1. JAX-RS as a standard for enterprise RESTful web application</a></li>
<li><a href="#_resteasy_as_portable_jax_rs_implementation">4.2. RESTeasy as portable JAX-RS implementation</a></li>
<li><a href="#_overview_of_classes_to_implement_a_jax_rs_service">4.3. Overview of classes to implement a JAX-RS service</a></li>
</ul>
</li>
<li><a href="#_equip_your_application_with_hystrix">5. Equip your application with Hystrix</a>
<ul class="sectlevel2">
<li><a href="#_ensuring_a_clean_start_up_and_shut_down_of_hystrix">5.1. Ensuring a clean start up and shut down of Hystrix</a></li>
<li><a href="#_wrap_external_interfaces_as_a_hystrix_command">5.2. Wrap external interfaces as a Hystrix Command</a></li>
</ul>
</li>
<li><a href="#_live_api_documentation">6. Live API documentation</a>
<ul class="sectlevel2">
<li><a href="#_swagger_creates_a_live_api_at_runtime">6.1. Swagger creates a live API at runtime</a></li>
<li><a href="#_adding_swagger">6.2. Adding Swagger</a></li>
<li><a href="#_accessing_the_live_api">6.3. Accessing the Live API</a></li>
</ul>
</li>
<li><a href="#_starting_up_the_application_container">7. Starting up the application container</a>
<ul class="sectlevel2">
<li><a href="#_apache_tomcat_is_is_an_easy_to_use_servlet_container">7.1. Apache Tomcat is is an easy to use servlet container</a></li>
<li><a href="#_installing_and_running_apache_tomcat">7.2. Installing and running Apache Tomcat</a></li>
</ul>
</li>
<li><a href="#archaius">8. Using runtime configuration</a>
<ul class="sectlevel2">
<li><a href="#_runtime_configuration_will_get_you_credits">8.1. Runtime configuration will get you credits</a></li>
<li><a href="#_netflix_archaius_to_the_rescue">8.2. Netflix Archaius to the rescue</a></li>
<li><a href="#_how_runtime_configuration_works_in_this_project">8.3. How runtime configuration works in this project</a></li>
<li><a href="#_configuring_the_hystrix_command_via_archaius">8.4. Configuring the Hystrix command via Archaius</a></li>
</ul>
</li>
<li><a href="#_building_and_deploying_the_application">9. Building and deploying the application</a>
<ul class="sectlevel2">
<li><a href="#_build_configuration_based_on_conventions_with_apache_maven">9.1. Build Configuration based on conventions with Apache Maven</a></li>
<li><a href="#_installing_apache_maven">9.2. Installing Apache Maven</a></li>
<li><a href="#_packaging_and_deploying_your_application_to_apache_tomcat">9.3. Packaging and deploying your application to Apache Tomcat</a></li>
</ul>
</li>
<li><a href="#jmeter">10. Putting your application under load</a>
<ul class="sectlevel2">
<li><a href="#_apache_jmeter_is_free_and_open_source_load_testing">10.1. Apache JMeter is free and open source load testing</a></li>
<li><a href="#_installing_apache_jmeter">10.2. Installing Apache JMeter</a></li>
<li><a href="#_simulating_multiple_users">10.3. Simulating multiple users</a></li>
</ul>
</li>
<li><a href="#_aggregating_hystrix_runtime_information_in_a_cluster">11. Aggregating Hystrix runtime information in a cluster</a>
<ul class="sectlevel2">
<li><a href="#_turbine_aggregates_runtime_information">11.1. Turbine aggregates runtime information</a></li>
<li><a href="#_installing_and_running_turbine">11.2. Installing and running Turbine</a></li>
<li><a href="#_configuration_for_turbine">11.3. Configuration for Turbine</a></li>
</ul>
</li>
<li><a href="#_displaying_hystrix_runtime_information_in_a_browser">12. Displaying Hystrix runtime information in a browser</a>
<ul class="sectlevel2">
<li><a href="#_hystrix_dashboard_displays_a_realtime_dashboard">12.1. Hystrix Dashboard displays a Realtime Dashboard</a></li>
<li><a href="#_installing_and_running_hystrix_dashboard">12.2. Installing and running Hystrix Dashboard</a></li>
</ul>
</li>
<li><a href="#_behaviour_of_hystrix_under_load">13. Behaviour of Hystrix under load</a>
<ul class="sectlevel2">
<li><a href="#_introduction_to_load_scenarios_for_hystrix">13.1. Introduction to Load Scenarios for Hystrix</a></li>
<li><a href="#_a_fast_response_10_ms">13.2. A fast response: 10 ms</a></li>
<li><a href="#_a_medium_response_70_ms">13.3. A medium response: 70 ms</a></li>
<li><a href="#_a_late_response_100_ms">13.4. A late response: 100 ms</a></li>
<li><a href="#_a_critical_response_200_ms">13.5. A critical response: 200 ms</a></li>
<li><a href="#_an_eternity_1500_ms">13.6. An eternity: 1500 ms</a></li>
<li><a href="#_hystrix_don_t_waste_resources_by_queueing_requests">13.7. Hystrix: Don&#8217;t waste resources by queueing requests</a></li>
</ul>
</li>
<li><a href="#_long_term_monitoring_of_hystrix_metrics">14. Long term monitoring of Hystrix metrics</a>
<ul class="sectlevel2">
<li><a href="#_zabbix_as_classic_long_term_monitoring_and_notification">14.1. Zabbix as classic long term monitoring and notification</a></li>
<li><a href="#_installing_and_running_zabbix">14.2. Installing and running Zabbix</a></li>
<li><a href="#_configuration_of_zabbix">14.3. Configuration of Zabbix</a></li>
<li><a href="#_configuration_of_the_example_application">14.4. Configuration of the example application</a></li>
<li><a href="#_zabbix_autodiscovery_at_work">14.5. Zabbix autodiscovery at work</a></li>
<li><a href="#_java_classes_to_forward_information_from_hystrix_to_zabbix">14.6. Java classes to forward information from Hystrix to Zabbix</a></li>
<li><a href="#_working_with_templates_in_zabbix">14.7. Working with templates in Zabbix</a></li>
</ul>
</li>
<li><a href="#_real_time_monitoring_of_hystrix_metrics">15. Real time monitoring of Hystrix metrics</a>
<ul class="sectlevel2">
<li><a href="#_riemann_as_cutting_edge_realtime_event_processing">15.1. Riemann as cutting edge realtime event processing</a></li>
<li><a href="#_installing_and_running_riemann">15.2. Installing and running Riemann</a></li>
<li><a href="#_how_events_are_captures_for_riemann">15.3. How Events are captures for Riemann</a></li>
<li><a href="#_configuring_riemann_server">15.4. Configuring Riemann Server</a></li>
<li><a href="#_configuring_riemann_dashboard">15.5. Configuring Riemann Dashboard</a></li>
</ul>
</li>
<li><a href="#_appendix">Appendix</a>
<ul class="sectlevel1">
<li><a href="#asciidoctor">16. Writing an online manual</a>
<ul class="sectlevel2">
<li><a href="#_asciidoctor_is_a_lean_tool_for_technical_documentation">16.1. Asciidoctor is a lean tool for technical documentation</a></li>
<li><a href="#_editors_to_work_on_asciidoctor">16.2. Editors to work on Asciidoctor</a></li>
</ul>
</li>
<li><a href="#vagrant">17. Running virtual machines for test and development</a>
<ul class="sectlevel2">
<li><a href="#_vagrant_manages_virtual_machines">17.1. Vagrant manages virtual machines</a></li>
<li><a href="#_installing_vagrant_and_useful_plugins">17.2. Installing Vagrant and useful plugins</a></li>
<li><a href="#_proxy_configuration_for_vagrant">17.3. Proxy configuration for Vagrant</a></li>
<li><a href="#_managing_virtual_machines_from_the_command_line">17.4. Managing virtual machines from the command line</a></li>
</ul>
</li>
<li><a href="#saltstack">18. Automatic provisioning of machines</a>
<ul class="sectlevel2">
<li><a href="#_saltstack_installation_automation">18.1. Saltstack installation automation</a></li>
<li><a href="#_running_saltstack_in_standalone_mode">18.2. Running Saltstack in standalone mode</a></li>
<li><a href="#_configuration_files_for_automatic_installation">18.3. Configuration files for automatic installation</a></li>
<li><a href="#_saltstack_commands">18.4. Saltstack commands</a></li>
</ul>
</li>
<li><a href="#_building_the_documentation_automatically">19. Building the documentation automatically</a>
<ul class="sectlevel2">
<li><a href="#_things_that_need_maintenance">19.1. Things that need maintenance</a></li>
<li><a href="#_travis_ci_as_a_service_in_the_cloud">19.2. Travis CI as a service in the cloud</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This started as a show case for Hystrix. As more tools have been added it might
also look for you as a walk through for different tools. Take a look around
and see what might fit your development environment.</p>
</div>
<div class="paragraph">
<p>&#8201;&#8212;&#8201;Alexander Schwartz (<a href="mailto:alexander.schwartz@gmx.net">alexander.schwartz@gmx.net</a>)</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_hystrix_make_your_application_resilient">1. Hystrix: Make your application resilient</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_build_your_application_to_handle_the_failure_of_external_services">1.1. Build your application to handle the failure of external services</h3>
<div class="paragraph">
<p>Your application has external runtime dependencies, like an external
validating service for data your user has entered, or the central CRM
of your company.</p>
</div>
<div class="paragraph">
<p>What will happen to your application when this external service has a problem?</p>
</div>
<div class="paragraph">
<p>In the worst case your application will become unavailable as well: The
screens of your application will freeze and not respond as the external
system doesn&#8217;t return with a response. Users and IT operations will call you
because they think it&#8217;s your fault and don&#8217;t suspect the external service.</p>
</div>
<div class="paragraph">
<p>But what should your application do, when the external service is unavailable?</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Provide timely responses to the users.</p>
</li>
<li>
<p>Give a detailed error message to the users.</p>
</li>
<li>
<p>Provide fall backs when the other service is down.</p>
</li>
<li>
<p>Hooks for IT operations for monitoring to pin-point the problematic service.</p>
</li>
<li>
<p>Prevent overloading of the problematic service to avoid domino effects.</p>
</li>
<li>
<p>Automatic recovery once the problematic service is online again.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_what_hystrix_has_built_in_ready_to_use">1.2. What Hystrix has built in ready-to-use</h3>
<div class="paragraph">
<p>These problems are not new. Netflix has solved them for their video on demand service. In 2012 they made their solution open source.</p>
</div>
<div class="paragraph">
<p>To deliver the above, Hystrix has built in the following defaults:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Timeout for every request to an external system (default: 1000 ms)</p>
</li>
<li>
<p>Limit of concurrent requests for external system (default: 10)</p>
</li>
<li>
<p>Circuit breaker to avoid further requests (default: when more than 50% of all requests fail)</p>
</li>
<li>
<p>Retry of a single request after circuit breaker has triggered (default: every 5 seconds)</p>
</li>
<li>
<p>Interfaces to retrieve runtime information on request and aggregate level (there&#8217;s even a ready-to-use realtime dashboard for it)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>It also shows you where you can place you fall back code.</p>
</div>
<div class="paragraph">
<p>Providing a detailed error message is then still a task for you.</p>
</div>
<div class="paragraph">
<p>For more details please have a look at <a href="http://hystrix.github.com" class="bare">http://hystrix.github.com</a>. The <a href="https://github.com/Netflix/Hystrix/wiki">wiki</a> gives detailed information how to use it and the mechanisms inside.</p>
</div>
</div>
<div class="sect2">
<h3 id="_hystrix_at_work">1.3. Hystrix at work</h3>
<div class="paragraph">
<p>To seek Hystrix at work in an example application I&#8217;ve built a REST application that will be put under load soon. Let&#8217;s start out with the scenario first.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_prerequisites_for_this_tutorial">2. Prerequisites for this tutorial</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_java_sdk_installed">2.1. Java SDK installed</h3>
<div class="paragraph">
<p>In order to run this application you&#8217;ll need to have Java installed. The minimum recommended version is Java JDK 7. I have performed my tests with Java JDK 8. Please download it from <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank">Oracle Java SE Download page</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_internet_connection_for_additional_downloads">2.2. Internet Connection for additional downloads</h3>
<div class="paragraph">
<p>In the process of the turorial you&#8217;ll need to download additional files from the internet. This includes i.e. Apache Tomcat and Apache Maven. All installations are scripted using small Powershell scripts. Expect a download an additional 100 MB during the tutorial.</p>
</div>
</div>
<div class="sect2">
<h3 id="_proxy_settings">2.3. Proxy settings</h3>
<div class="paragraph">
<p>When using Maven behind a proxy, please setup your proxy for protocols http and https in <code>tools\maven\apache-maven-3.2.x\conf\settings.xml</code>. You should specify the username and password only when this is necessary in your configuration. Please leave it blank otherwise. Please ensure that <code>localhost</code> is listed in <code>nonProxyHosts</code> otherwise the automatic deployment to the locally installed tomcat might not work.</p>
</div>
<div class="listingblock">
<div class="title">settings.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;proxy&gt;</span>
  <span class="tag">&lt;id&gt;</span>optional<span class="tag">&lt;/id&gt;</span>
  <span class="tag">&lt;active&gt;</span>true<span class="tag">&lt;/active&gt;</span>
  <span class="tag">&lt;protocol&gt;</span>http<span class="tag">&lt;/protocol&gt;</span>
  <span class="tag">&lt;username&gt;</span>proxyuser<span class="tag">&lt;/username&gt;</span>
  <span class="tag">&lt;password&gt;</span>proxypass<span class="tag">&lt;/password&gt;</span>
  <span class="tag">&lt;host&gt;</span>proxy.host.net<span class="tag">&lt;/host&gt;</span>
  <span class="tag">&lt;port&gt;</span>80<span class="tag">&lt;/port&gt;</span>
  <span class="tag">&lt;nonProxyHosts&gt;</span>localhost|local.net|some.host.com<span class="tag">&lt;/nonProxyHosts&gt;</span>
<span class="tag">&lt;/proxy&gt;</span>
<span class="tag">&lt;proxy&gt;</span>
  <span class="tag">&lt;id&gt;</span>optional<span class="tag">&lt;/id&gt;</span>
  <span class="tag">&lt;active&gt;</span>true<span class="tag">&lt;/active&gt;</span>
  <span class="tag">&lt;protocol&gt;</span>http<span class="tag">&lt;/protocol&gt;</span>
  <span class="tag">&lt;username&gt;</span>proxyuser<span class="tag">&lt;/username&gt;</span>
  <span class="tag">&lt;password&gt;</span>proxypass<span class="tag">&lt;/password&gt;</span>
  <span class="tag">&lt;host&gt;</span>proxy.host.net<span class="tag">&lt;/host&gt;</span>
  <span class="tag">&lt;port&gt;</span>80<span class="tag">&lt;/port&gt;</span>
  <span class="tag">&lt;nonProxyHosts&gt;</span>localhost|local.net|some.host.com<span class="tag">&lt;/nonProxyHosts&gt;</span>
<span class="tag">&lt;/proxy&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_scenario_to_challenge_hystrix_external_bank_validation">3. Scenario to challenge Hystrix: External Bank validation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_iban_and_bic_validations">3.1. IBAN and BIC validations</h3>
<div class="paragraph">
<p>Most of Europe have changed to SEPA in early 2014. Instead of national account number and bank sorting code you now have a <a href="http://en.wikipedia.org/wiki/IBAN">IBAN</a> (International Bank Account Number) and <a href="http://en.wikipedia.org/wiki/ISO_9362">BIC</a> (Bank Identifier Code).</p>
</div>
<div class="paragraph">
<p>When customers enter their bank details on your website, you want to validate these. As the IBAN includes a check digit, you can implement this check.
The BIC doesn&#8217;t have a check digit, so you can only verify it by lookup in a dictionary.</p>
</div>
<div class="paragraph">
<p>Things get messy as the BIC might not match the IBAN, or the IBAN might
not be valid for direct debit/clearing.</p>
</div>
<div class="paragraph">
<p>The good news: There are external services that do the validation for you.</p>
</div>
</div>
<div class="sect2">
<h3 id="_simulating_an_external_iban_bic_validation_service">3.2. Simulating an external IBAN/BIC validation service</h3>
<div class="paragraph">
<p>As we want to show what Hystrix can do for us, we need a IBAN/BIC
validation service. We simulate the behaviour with a small Java procedure:</p>
</div>
<div class="listingblock">
<div class="title">IBANValidator.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">public</span> <span class="type">class</span> <span class="class">IBANValidator</span> {

    <span class="directive">private</span> <span class="directive">static</span> <span class="predefined-type">Logger</span> LOG = LoggerFactory.getLogger(IBANValidator.class);

    <span class="directive">private</span> <span class="directive">static</span> DynamicLongProperty timeToWait = DynamicPropertyFactory
            .getInstance().getLongProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">hystrixdemo.sleep</span><span class="delimiter">&quot;</span></span>, <span class="integer">100</span>);


    <span class="directive">public</span> <span class="directive">static</span> <span class="directive">synchronized</span> <span class="type">boolean</span> isValid(Account account)
            <span class="directive">throws</span> <span class="exception">InterruptedException</span> {
        <span class="keyword">if</span> (<span class="predefined-type">Thread</span>.currentThread().isInterrupted()) {
            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="exception">InterruptedException</span>();
        }
        <span class="type">long</span> t = timeToWait.get();
        LOG.info(<span class="string"><span class="delimiter">&quot;</span><span class="content">waiting {} ms</span><span class="delimiter">&quot;</span></span>, t);
        <span class="keyword">if</span> (t &gt; <span class="integer">0</span>) {
            <span class="predefined-type">Thread</span>.sleep(t);
        }
        <span class="keyword">return</span> <span class="predefined-constant">true</span>;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The core of the simulation is the static <code>isValid()</code> method. As it is synchronized, it will validate one account at a time.</p>
</div>
<div class="paragraph">
<p>To simulate the processing, we use <code>Thread.sleep()</code>. The delay is by default 100 ms. This can be configured at runtime using an <code>DynamicLongProperty</code>. See the chapter <a href="#archaius">Using runtime configuration</a> below. Changing the delay at runtime will help us later to try out different scenarios.</p>
</div>
<div class="paragraph">
<p>When someone interrupts the thread while waiting for the <code>synchronized</code> lock or for <code>Thread.sleep()</code>, the method will throw an <code>InterruptedException</code>.</p>
</div>
<div class="paragraph">
<p>This is a standard Java feature that will be used by Hystrix to notify a service call that is taking too long.</p>
</div>
<div class="paragraph">
<p>You find this source code in the <code>hystrix-application</code> folder.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_writing_a_real_application_with_jax_rs">4. Writing a real application with JAX-RS</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_jax_rs_as_a_standard_for_enterprise_restful_web_application">4.1. JAX-RS as a standard for enterprise RESTful web application</h3>
<div class="paragraph">
<p>JAX-RS is part of the JavaEE Standard. It defines how a JavaEE
application needs to be structured to respond to HTTP-REST-Calls.</p>
</div>
<div class="paragraph">
<p>REST calls have the following advantages:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>With their JSON-interface they can be interfaced easily from JavaScript clients.</p>
</li>
<li>
<p>The REST API can also be easily tested for functional and load testing (see <a href="#jmeter">Putting your application under load</a> below).</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_resteasy_as_portable_jax_rs_implementation">4.2. RESTeasy as portable JAX-RS implementation</h3>
<div class="paragraph">
<p><a href="http://resteasy.jboss.org/">RESTEasy</a> by JBoss is a portable implementation of the standard. It adds also several enterprise
features like authentication and signatures.</p>
</div>
<div class="paragraph">
<p>As a portable implementation I can easily deploy it to a Tomcat
application server later.</p>
</div>
</div>
<div class="sect2">
<h3 id="_overview_of_classes_to_implement_a_jax_rs_service">4.3. Overview of classes to implement a JAX-RS service</h3>
<div class="paragraph">
<p>You find the example application in the folder <code>hystrix-application</code>.</p>
</div>
<div class="sect3">
<h4 id="_application_as_the_starting_point">4.3.1. Application as the starting point</h4>
<div class="paragraph">
<p>JAX-RS requires you to name all classes related to the REST part of your application. This class needs to extend <code>javax.ws.rs.core.Application</code>:</p>
</div>
<div class="listingblock">
<div class="title">HystrixApplication.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@ApplicationPath</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/api</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">HystrixApplication</span> <span class="directive">extends</span> Application {
    <span class="directive">private</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">Object</span>&gt; singletons = <span class="keyword">new</span> <span class="predefined-type">HashSet</span>&lt;<span class="predefined-type">Object</span>&gt;();

    <span class="directive">public</span> HystrixApplication() {
        singletons.add(<span class="keyword">new</span> SimpleSaveAccount());
        singletons.add(<span class="keyword">new</span> HystrixSaveAccount());
        singletons.add(<span class="keyword">new</span> ValidationExceptionMapper());
        singletons.add(<span class="keyword">new</span> InterruptedExceptionMapper());
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">Set</span>&lt;<span class="predefined-type">Object</span>&gt; getSingletons() {
        <span class="keyword">return</span> singletons;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This very basic setup lists the two REST endpoints <code>SimpleSaveAccount</code> and <code>HystrixSaveAccount</code> we will
look at later plus two exception handlers <code>ValidationExceptionMapper</code> and <code>InterruptedExceptionMapper</code>.</p>
</div>
<div class="paragraph">
<p>It also defines that the URL <code>/api</code> will be used for all JAX-RS requests relative to the application.</p>
</div>
</div>
<div class="sect3">
<h4 id="_simplesaveaccount_as_rest_endpoint">4.3.2. SimpleSaveAccount as REST endpoint</h4>
<div class="paragraph">
<p>JAX-RS requires you to name all classes related to the REST part of your application. This class needs to extend <code>javax.ws.rs.core.Application</code>:</p>
</div>
<div class="listingblock">
<div class="title">SimpleSaveAccount.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Path</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/simple</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> <span class="type">class</span> <span class="class">SimpleSaveAccount</span> <span class="directive">extends</span> AbstractSaveAccount {

    <span class="annotation">@GET</span>
    <span class="annotation">@Produces</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">text/plain</span><span class="delimiter">&quot;</span></span>)
    <span class="directive">public</span> Response hello() {
        <span class="keyword">return</span> Response.status(Status.OK).entity(<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello world</span><span class="delimiter">&quot;</span></span>).build();
    }

    <span class="annotation">@POST</span>
    <span class="directive">public</span> Response save(Account account) <span class="directive">throws</span> ValidationException,
            <span class="exception">InterruptedException</span> {
        <span class="keyword">if</span> (!IBANValidator.isValid(account)) {
            <span class="keyword">throw</span> <span class="keyword">new</span> ValidationException(<span class="string"><span class="delimiter">&quot;</span><span class="content">invalid</span><span class="delimiter">&quot;</span></span>);
        }
        <span class="local-variable">super</span>.saveToDatabase(account);
        <span class="keyword">return</span> Response.status(Status.OK).build();
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This defines for the URL <code>/simple</code> relative to the application defined above how to react on <code>GET</code> and <code>POST</code> requests.</p>
</div>
<div class="paragraph">
<p>A <code>GET</code>-Request will return with an empty <code>200 OK</code> response. This enables us to use a simple browser request to test the successful deployment of our application.</p>
</div>
<div class="paragraph">
<p>A <code>POST</code>-Request will have a parameter of type <code>Account</code>. If the account is invalid, it will throw an exception. Otherwise it will save the account. In our sample application the save operation is a dummy implementation that does nothing. After the save returned, the response is <code>200 OK</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_exceptionmappers_to_handle_exceptions">4.3.3. ExceptionMappers to handle Exceptions</h4>
<div class="paragraph">
<p>Unhandled exceptions result in the application server to present a standard <code>500</code> error page that (depending on the application servers&#8217;s configuration) might also include a stack trace of the application.</p>
</div>
<div class="paragraph">
<p>To avoid this and to return REST-ful error messages exceptions are mapped by an <code>ExceptionMapper</code>.</p>
</div>
<div class="listingblock">
<div class="title">ValidationExceptionMapper.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="annotation">@Provider</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ValidationExceptionMapper</span> <span class="directive">implements</span>
        ExceptionMapper&lt;ValidationException&gt; {

    <span class="annotation">@Context</span>
    <span class="directive">private</span> HttpHeaders headers;

    <span class="annotation">@Override</span>
    <span class="directive">public</span> Response toResponse(ValidationException e) {
        <span class="keyword">return</span> Response.status(Status.BAD_REQUEST)
                .entity(<span class="keyword">new</span> Message(e.getMessage()))
                .type(headers.getMediaType()).build();
    }

}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_equip_your_application_with_hystrix">5. Equip your application with Hystrix</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_ensuring_a_clean_start_up_and_shut_down_of_hystrix">5.1. Ensuring a clean start up and shut down of Hystrix</h3>
<div class="paragraph">
<p>When you want to run code at the start and at the end of a JEE Web application, the place for this is <code>@WebListener</code>. The servlet container will scan for classes with this annotation and run their <code>contextInitialized()</code> and <code>contextDestroyed()</code> methods.</p>
</div>
<div class="paragraph">
<p>To start up Hystrix there is nothing to do; you can just go ahead and use it.</p>
</div>
<div class="paragraph">
<p>I recommend a shut down of Hystrix as it starts several thread pools to do its job. Just add the line</p>
</div>
<div class="listingblock">
<div class="title">HystrixSetupListener.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// shutdown all thread pools; waiting a little time for shutdown</span>
Hystrix.reset(<span class="integer">1</span>, <span class="predefined-type">TimeUnit</span>.SECONDS);</code></pre>
</div>
</div>
<div class="paragraph">
<p>As Hystrix uses Archaius as a default for runtime configuration, we should shut down it as well.</p>
</div>
<div class="listingblock">
<div class="title">HystrixSetupListener.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="comment">// shutdown configuration listeners that might have been activated by</span>
<span class="comment">// Archaius</span>
<span class="keyword">if</span> (ConfigurationManager.getConfigInstance() <span class="keyword">instanceof</span> DynamicConfiguration) {
    ((DynamicConfiguration) ConfigurationManager.getConfigInstance())
            .stopLoading();
} <span class="keyword">else</span> <span class="keyword">if</span> (ConfigurationManager.getConfigInstance() <span class="keyword">instanceof</span> ConcurrentCompositeConfiguration) {
    ConcurrentCompositeConfiguration config =
            ((ConcurrentCompositeConfiguration) ConfigurationManager
                    .getConfigInstance());
    <span class="keyword">for</span> (AbstractConfiguration innerConfig : config.getConfigurations()) {
        <span class="keyword">if</span> (innerConfig <span class="keyword">instanceof</span> DynamicConfiguration) {
            ((DynamicConfiguration) innerConfig).stopLoading();
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wrap_external_interfaces_as_a_hystrix_command">5.2. Wrap external interfaces as a Hystrix Command</h3>
<div class="paragraph">
<p>The core of the application is now set up. To benefit from Hystrix each call needs to be wrapped as a Hystrix command.</p>
</div>
<div class="listingblock">
<div class="title">HystrixSaveAccount.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="directive">static</span> <span class="type">class</span> <span class="class">IBANValidatorCommand</span> <span class="directive">extends</span> HystrixCommand&lt;<span class="predefined-type">Boolean</span>&gt; {
    <span class="directive">private</span> Account account;

    <span class="directive">protected</span> IBANValidatorCommand(Account account) {
        <span class="local-variable">super</span>(Setter.withGroupKey(HystrixCommandGroupKey.Factory
                .asKey(<span class="string"><span class="delimiter">&quot;</span><span class="content">iban</span><span class="delimiter">&quot;</span></span>)));
        <span class="local-variable">this</span>.account = account; <i class="conum" data-value="2"></i><b>(2)</b>
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="predefined-type">Boolean</span> run() <span class="directive">throws</span> <span class="exception">Exception</span> {
        <span class="keyword">return</span> IBANValidator.isValid(account); <i class="conum" data-value="3"></i><b>(3)</b>
    }

}

<span class="annotation">@POST</span>
<span class="annotation">@ApiOperation</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">save account data</span><span class="delimiter">&quot;</span></span>)
<span class="directive">public</span> Response save(Account account) <span class="directive">throws</span> ValidationException,
        <span class="exception">InterruptedException</span> {
    <span class="keyword">try</span> {
        <span class="keyword">if</span> (!<span class="keyword">new</span> IBANValidatorCommand(account).execute()) { <i class="conum" data-value="1"></i><b>(1)</b>
            <span class="keyword">throw</span> <span class="keyword">new</span> ValidationException(<span class="string"><span class="delimiter">&quot;</span><span class="content">invalid</span><span class="delimiter">&quot;</span></span>);
        }
    } <span class="keyword">catch</span> (HystrixRuntimeException e) { <i class="conum" data-value="4"></i><b>(4)</b>
        <span class="keyword">if</span> (e.getCause() <span class="keyword">instanceof</span> <span class="exception">InterruptedException</span>) {
            <span class="keyword">throw</span> (<span class="exception">InterruptedException</span>) e.getCause();
        }
        LOG.error(<span class="string"><span class="delimiter">&quot;</span><span class="content">problem with command: {}</span><span class="delimiter">&quot;</span></span>, e.getMessage());
        <span class="keyword">return</span> Response.status(Status.SERVICE_UNAVAILABLE).build();
    }
    <span class="local-variable">super</span>.saveToDatabase(account);
    <span class="keyword">return</span> Response.status(Status.OK).build();
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>constructing the wrapper</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>memorizing the parameters</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>calling the original code</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>taking care of the additional runtime exception that originates from an exception of the services, or from the resilience functionality of Hystrix</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When there is a problem with the Hystrix command there will be a <code>HystrixRuntimeException</code>. This will occur in two cases:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Hystrix circuit breaker or time out handler are activated.</p>
</li>
<li>
<p>The original command throws an exception.</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you want to handle the exceptions of your service as before, you will need to unwrap them.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_live_api_documentation">6. Live API documentation</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_swagger_creates_a_live_api_at_runtime">6.1. Swagger creates a live API at runtime</h3>
<div class="paragraph">
<p><a href="http://swagger.io/">Swagger</a> allows you to annotate your REST endpoints. The information from the JAX-RS annotation and the Swagger annotations is collected at runtime.</p>
</div>
</div>
<div class="sect2">
<h3 id="_adding_swagger">6.2. Adding Swagger</h3>
<div class="paragraph">
<p>To add Swagger to your project, annotate your REST endpoints with <code>@ApiOperation</code> and <code>@Api</code> annotations.</p>
</div>
<div class="paragraph">
<p>Add the following dependency to your Maven configuration:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>com.wordnik<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>swagger-jaxrs_2.10<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>compile<span class="tag">&lt;/scope&gt;</span>
    <span class="tag">&lt;version&gt;</span>1.3.10<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The following snipped is needed in your web configuration:</p>
</div>
<div class="listingblock">
<div class="title">web.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context-param&gt;</span>
    <span class="tag">&lt;param-name&gt;</span>resteasy.resources<span class="tag">&lt;/param-name&gt;</span>
    <span class="tag">&lt;param-value&gt;</span>com.wordnik.swagger.jaxrs.listing.ApiListingResourceJSON<span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span>
<span class="tag">&lt;context-param&gt;</span>
    <span class="tag">&lt;param-name&gt;</span>resteasy.providers<span class="tag">&lt;/param-name&gt;</span>
    <span class="tag">&lt;param-value&gt;</span>com.wordnik.swagger.jaxrs.json.JacksonJsonProvider,com.wordnik.swagger.jaxrs.listing.ApiDeclarationProvider,com.wordnik.swagger.jaxrs.listing.ResourceListingProvider<span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span>
<span class="tag">&lt;servlet&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>DefaultJaxrsConfig<span class="tag">&lt;/servlet-name&gt;</span>
    <span class="tag">&lt;servlet-class&gt;</span>com.wordnik.swagger.jaxrs.config.DefaultJaxrsConfig<span class="tag">&lt;/servlet-class&gt;</span>
    <span class="tag">&lt;init-param&gt;</span>
        <span class="tag">&lt;param-name&gt;</span>api.version<span class="tag">&lt;/param-name&gt;</span>
        <span class="tag">&lt;param-value&gt;</span>1.0.0<span class="tag">&lt;/param-value&gt;</span>
    <span class="tag">&lt;/init-param&gt;</span>
    <span class="tag">&lt;init-param&gt;</span>
        <span class="tag">&lt;param-name&gt;</span>swagger.api.basepath<span class="tag">&lt;/param-name&gt;</span>
        <span class="tag">&lt;param-value&gt;</span>http://localhost:8080/hystrixapp/api<span class="tag">&lt;/param-value&gt;</span>
    <span class="tag">&lt;/init-param&gt;</span>
    <span class="tag">&lt;load-on-startup&gt;</span>2<span class="tag">&lt;/load-on-startup&gt;</span>
<span class="tag">&lt;/servlet&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_accessing_the_live_api">6.3. Accessing the Live API</h3>
<div class="paragraph">
<p>The Live API will be deployed as part of the application. You can access it with your browser using the following URL: <a href="http://localhost:8080/hystrixapp/swagger/" class="bare">http://localhost:8080/hystrixapp/swagger/</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="manual/swagger.png" alt="Swagger Overview">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_starting_up_the_application_container">7. Starting up the application container</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_apache_tomcat_is_is_an_easy_to_use_servlet_container">7.1. Apache Tomcat is is an easy to use servlet container</h3>
<div class="paragraph">
<p><a href="http://tomcat.apache.org">Apache Tomcat</a> is a servlet container. It can run JavaEE Web applications like our JAX-RS applications.</p>
</div>
<div class="paragraph">
<p>Tomcat Version 8 is implementing the JavaEE 7 standard supporting
the latest APIs.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installing_and_running_apache_tomcat">7.2. Installing and running Apache Tomcat</h3>
<div class="paragraph">
<p>Installation is straight forward: After the download only few
configuration steps are necessary.</p>
</div>
<div class="paragraph">
<p>All of these have been prepared in the script <code>tools/tomcat/run-tomcat.bat</code>. When you start it the first time, the the script will download the installation archive, unzip it and update the configuration.</p>
</div>
<div class="sect3">
<h4 id="_activated_apache_tomcat_features">7.2.1. Activated Apache Tomcat features</h4>
<div class="paragraph">
<p>The following features are being set up using the automatic installation:</p>
</div>
<div class="paragraph">
<p>In <code>setenv.bat</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Allow Java remote debugging on port 1044<br></p>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=1044</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>In <code>context.xml</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Activate <code>antiResourceLocking</code> to allow hot-deployment of applications when running Microsoft Windows as operating system</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In <code>tomcat-users.xml</code>:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Setup an user <code>deploy</code> with password <code>deploy</code> to automatically deploy an application.</p>
</li>
<li>
<p>Setup an user <code>tomcat</code> with password <code>tomcat</code> to allow login on the management GUI.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_testing_the_apache_tomcat_installation">7.2.2. Testing the Apache Tomcat installation</h4>
<div class="paragraph">
<p>To test the application point your browser at <a href="http://localhost:8080" class="bare">http://localhost:8080</a>. You should see an Apache Tomcat start page with the welcome message (see figure <a href="#img-tomcatwelcome">Apache Tomcat Welcome Message</a>).</p>
</div>
<div id="img-tomcatwelcome" class="imageblock">
<div class="content">
<img src="manual/tomcatwelcome.png" alt="Tomcat Welcome Message">
</div>
<div class="title">Figure 1. Apache Tomcat Welcome Message</div>
</div>
<div class="paragraph">
<p>Click on the button <strong>Manager App</strong> and you will be asked for a user name and password. Use the user <code>tomcat</code> with the password stated above to log in.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="archaius">8. Using runtime configuration</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_runtime_configuration_will_get_you_credits">8.1. Runtime configuration will get you credits</h3>
<div class="paragraph">
<p>If you would write applications that would require a restart every
time you change a setting, it will deter your users as you will have
a downtime.</p>
</div>
<div class="paragraph">
<p>How nice if you could change all your settings at runtime! No more night shifts for IT operating to change parameters and restart the services!</p>
</div>
</div>
<div class="sect2">
<h3 id="_netflix_archaius_to_the_rescue">8.2. Netflix Archaius to the rescue</h3>
<div class="paragraph">
<p>Hystrix is integrated already with  <a href="https://github.com/Netflix/archaius" target="_blank">Archaius</a> that handles runtime
configuration for you. When implementing <code>IBANValidator</code> you&#8217;ve seen the dynamic property being introduced:</p>
</div>
<div class="listingblock">
<div class="title">IBANValidator.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="directive">private</span> <span class="directive">static</span> DynamicLongProperty timeToWait = DynamicPropertyFactory
        .getInstance().getLongProperty(<span class="string"><span class="delimiter">&quot;</span><span class="content">hystrixdemo.sleep</span><span class="delimiter">&quot;</span></span>, <span class="integer">100</span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will create a dynamic property. When it&#8217;s being accessed, it will always return the most up to date value for it. When the external configuration doesn&#8217;t define a value the default of 100 will be returned.</p>
</div>
<div class="paragraph">
<p>In more advanced situations you can also register a callback to be notified whenever a configuration changes. Please refer to the <a href="https://github.com/Netflix/archaius/wiki" target="_blank">Archaius Wiki</a> to find out more about it.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_runtime_configuration_works_in_this_project">8.3. How runtime configuration works in this project</h3>
<div class="paragraph">
<p>Archaius supports multiple back ends to store configuration data. In this setup all configuration is stored in a Java properties file. Archaius checks this file every second.</p>
</div>
<div class="paragraph">
<p>This is configured as follows:</p>
</div>
<div class="listingblock">
<div class="title">setenv.bat</div>
<div class="content">
<pre class="CodeRay highlight"><code>-Darchaius.configurationSource.additionalUrls=file:///%CATALINA_HOME%/../archaius.properties
-Darchaius.fixedDelayPollingScheduler.delayMills=1000
-Darchaius.fixedDelayPollingScheduler.initialDelayMills=1000</code></pre>
</div>
</div>
<div class="paragraph">
<p>This allows you to change the dynamic:</p>
</div>
<div class="listingblock">
<div class="title">archaius.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code>hystrixdemo.sleep=10</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will override the default setting with 10.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_the_hystrix_command_via_archaius">8.4. Configuring the Hystrix command via Archaius</h3>
<div class="paragraph">
<p>All Hystrix settings can be configured on default and on command level. Please refer to the <a href="https://github.com/Netflix/Hystrix/wiki/Configuration">Configuration Wiki of Hystrix</a> for an in-depth discussion. This will now show the core parameters and configure them on default level:</p>
</div>
<div class="listingblock">
<div class="title">archaius.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code># Should Hystrix interrupt a command that is overdue?
# default: true
hystrix.command.default.execution.isolation.thread.interruptOnTimeout=true

# How long should Hystrix wait for a response?
# default: 1000
hystrix.command.default.execution.isolation.thread.timeoutInMilliseconds=1000

# How many errors are allowed before the circuit breaker is activated?
# default: 50 (must be greater than 0,
# 100 means no breaking despite of errors)
hystrix.command.default.circuitBreaker.errorThresholdPercentage=50

# How many requests are needed in the time span to trigger the circuit breaker?
# default: 20
hystrix.command.default.circuitBreaker.requestVolumeThreshold=20

# After what time (in ms) should the circuit breaker try a single request?
# default: 5000
hystrix.command.default.circuitBreaker.sleepWindowInMilliseconds=5000</code></pre>
</div>
</div>
<div class="paragraph">
<p>To give these parameters a try you should set up a load test. You&#8217;ll see in the next chapter how you can do this. But first deploy the application to this freshly installed Tomcat!</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_building_and_deploying_the_application">9. Building and deploying the application</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_build_configuration_based_on_conventions_with_apache_maven">9.1. Build Configuration based on conventions with Apache Maven</h3>
<div class="paragraph">
<p><a href="http://maven.apache.org/" target="_blank">Apache Maven</a> as a build system you the following advantages:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Project layout based on conventions (i.e. your source files are in <code>src/main/java</code>)</p>
</li>
<li>
<p>Management of binary artefacts including transitive dependencies</p>
</li>
<li>
<p>A lot of plugins to automate your build</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_installing_apache_maven">9.2. Installing Apache Maven</h3>
<div class="paragraph">
<p>This process has been automated for you. The first time you start <code>tools/maven/run-maven.bat</code> Maven is downloaded and installed.</p>
</div>
<div class="paragraph">
<p>The following configuration is applied:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>All dependencies will be downloaded to the folder <code>tools/maven/m2</code>. This folder will be used as a cache: All dependencies will be only downloaded once.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_packaging_and_deploying_your_application_to_apache_tomcat">9.3. Packaging and deploying your application to Apache Tomcat</h3>
<div class="paragraph">
<p>To do this run <code>hystrix-application/maven-package-deploy.bat</code>. <strong>Please ensure that your Apache Tomcat is running,</strong> as Maven will deploy your application into the running Apache Tomcat.</p>
</div>
<div class="paragraph">
<p>The steps executed by Maven <code>mvn clean package cargo:redeploy</code> included in the Batch-file:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Clean up the build folder <code>target</code>,</p>
</li>
<li>
<p>download all dependencies from public Maven repositories if they haven&#8217;t been downloaded yet,<br>
(this might take a while on the first run depending on the speed of your Internet connection)</p>
</li>
<li>
<p>compile all Java sources,</p>
</li>
<li>
<p>package a WAR file in the <code>target</code> folder,</p>
</li>
<li>
<p>deploy it to your running Tomcat instance.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To test that your application has been deployed successfully, open the URL <a href="http://localhost:8080/hystrixapp/api/simple" target="_blank">http://localhost:8080/hystrixapp/api/simple</a> in your browser.
You should get the response <code>Hello world</code> to show you that everything has been set up correctly.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jmeter">10. Putting your application under load</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_apache_jmeter_is_free_and_open_source_load_testing">10.1. Apache JMeter is free and open source load testing</h3>
<div class="paragraph">
<p><a href="http://jmeter.apache.org/" target="_blank">Apache JMeter</a> allows you to create
and run load tests simulating the load of multiple users using
a single PC.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installing_apache_jmeter">10.2. Installing Apache JMeter</h3>
<div class="paragraph">
<p>This process has been automated for you. The first time you start <code>tools/maven/run-jmeter.bat</code> JMeter is downloaded and installed.</p>
</div>
<div class="paragraph">
<p>The following defaults are applied:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Whenever you run JMeter using the script above, the load testing script <code>hystrixSaveAccount.jmx</code> is opened.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You will see the <a href="#img-jmeterwelcome">Apache JMeter Start Screen</a>.</p>
</div>
<div id="img-jmeterwelcome" class="imageblock">
<div class="content">
<img src="manual/jmeterwelcome.png" alt="JMeter Start Screen">
</div>
<div class="title">Figure 2. Apache JMeter Start Screen</div>
</div>
</div>
<div class="sect2">
<h3 id="_simulating_multiple_users">10.3. Simulating multiple users</h3>
<div class="paragraph">
<p>You can vary the number of simulated users by changing the number of threads. In this script the number of users is configured to be 20.</p>
</div>
<div class="paragraph">
<p>A test with JMeter has the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>choose the number of users (aka threads)</p>
</li>
<li>
<p>press the play <span class="image"><img src="manual/jmeter-play.png" alt="Play" title="Play"></span> button to start the workers</p>
</li>
<li>
<p>press the stop <span class="image"><img src="manual/jmeter-stop.png" alt="Stop" title="Stop"></span> button to stop the workers</p>
</li>
<li>
<p>Watch the summary report to see the timing of the requests and how many requests succeed and fail</p>
</li>
<li>
<p>Watch the log file of Apache Tomcat for exceptions and other log messages</p>
</li>
<li>
<p>Change the Archaius runtime configuration and see how the behaviour of the system changes (see section <a href="#archaius">Using runtime configuration</a> for the details).</p>
</li>
<li>
<p>press the clean <span class="image"><img src="manual/jmeter-clean.png" alt="Clean" title="Clean"></span> button to clear the results from JMeter</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
When you change the number of users (aka threads) it will become effective only after you stop/start the workers.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_aggregating_hystrix_runtime_information_in_a_cluster">11. Aggregating Hystrix runtime information in a cluster</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_turbine_aggregates_runtime_information">11.1. Turbine aggregates runtime information</h3>
<div class="paragraph">
<p><a href="https://github.com/Netflix/Turbine">Netflix Turbine</a> is a web application that connects to instances of your Hystrix application in a cluster and aggregates the information.</p>
</div>
<div class="paragraph">
<p>It does this in real time. The results will be updated every 0.5 seconds.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installing_and_running_turbine">11.2. Installing and running Turbine</h3>
<div class="paragraph">
<p>The installation has been scripted for you: You need to run <code>tools/turbine/maven-package-deploy.bat</code>.</p>
</div>
<div class="paragraph">
<p>The current installation will re-package the 0.4 version of Turbine and add to it the latest (yet unreleased) changes to allow easy re-deployment. Please have a look into <code>pom.xml</code> to see how you can adopt an already packaged WAR file to your environment.</p>
</div>
<div class="paragraph">
<p>You can open the URL <a href="http://localhost:8080/turbine/turbine.stream" class="bare">http://localhost:8080/turbine/turbine.stream</a> in a Google Chrome browser to see the stream of events. If there are no Hystrix requests, you&#8217;ll see only "ping" messages. You can&#8217;t test this with Mozilla Firefox or Microsoft Internet Explorer as they will open only a file download dialogue.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_for_turbine">11.3. Configuration for Turbine</h3>
<div class="sect3">
<h4 id="_configuration_turbine_metadata">11.3.1. Configuration Turbine metadata</h4>
<div class="paragraph">
<p>Turbine uses the same configuration mechanism as Hystrix: Archaius. See chapter "<a href="#archaius">Using runtime configuration</a> for more information. The following configuration has already been set up for you in <code>archaius.properties</code>:</p>
</div>
<div class="listingblock">
<div class="title">archaius.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code>turbine.instanceUrlSuffix=:8080/hystrixapp/hystrix.stream
turbine.ConfigPropertyBasedDiscovery.default.instances=localhost</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>turbine.instanceUrlSuffix</code>: This URL suffix needs to be the same for all applications in the cluster. Turbine uses this endpoint to receive a stream of runtime information.</p>
</div>
<div class="paragraph">
<p><code>turbine.ConfigPropertyBasedDiscovery.default.instances</code>: This lists the hosts Turbine should poll information from. In a production system there are mechanisms to discover hosts automatically. In our test scenario a list is sufficient as we have only one host.</p>
</div>
</div>
<div class="sect3">
<h4 id="_preparing_your_application_for_turbine">11.3.2. Preparing your application for Turbine</h4>
<div class="paragraph">
<p>To have your application publishing the information on the URL suffix above, you&#8217;ll need to add a servlet to your application. This has already been packaged for you. You&#8217;ll just need to include as a dependency of your application in <code>pom.xml</code>:</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- include metrics event stream --&gt;</span>
<span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>com.netflix.hystrix<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>hystrix-metrics-event-stream<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;version&gt;</span>${hystrix}<span class="tag">&lt;/version&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Then you register it in <code>web.xml</code> as a servlet:</p>
</div>
<div class="listingblock">
<div class="title">web.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="comment">&lt;!-- include metrics event stream --&gt;</span>
<span class="tag">&lt;servlet&gt;</span>
    <span class="tag">&lt;description&gt;</span><span class="tag">&lt;/description&gt;</span>
    <span class="tag">&lt;display-name&gt;</span>HystrixMetricsStreamServlet<span class="tag">&lt;/display-name&gt;</span>
    <span class="tag">&lt;servlet-name&gt;</span>HystrixMetricsStreamServlet<span class="tag">&lt;/servlet-name&gt;</span>
    <span class="tag">&lt;servlet-class&gt;</span>com.netflix.hystrix.contrib.metrics.eventstream.HystrixMetricsStreamServlet<span class="tag">&lt;/servlet-class&gt;</span>
<span class="tag">&lt;/servlet&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can open the URL <a href="http://localhost:8080/hystrixapp/hystrix.stream" class="bare">http://localhost:8080/hystrixapp/hystrix.stream</a> in a Google Chrome browser to see the stream of events. If there are no Hystrix requests, you&#8217;ll see only "ping" messages. You can&#8217;t test this with Mozilla Firefox or Microsoft Internet Explorer as they will open only a file download dialogue.</p>
</div>
<div class="paragraph">
<p>To visualize it, see the next chapter about Hystrix dashboard.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_displaying_hystrix_runtime_information_in_a_browser">12. Displaying Hystrix runtime information in a browser</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_hystrix_dashboard_displays_a_realtime_dashboard">12.1. Hystrix Dashboard displays a Realtime Dashboard</h3>
<div class="paragraph">
<p><a href="https://github.com/Netflix/Hystrix/tree/master/hystrix-dashboard" target="_blank">Hystrix Dashboard</a> is part of the Hystrix distribution. It displays runtime information about every Hystrix command and thread pool for the last few minutes.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installing_and_running_hystrix_dashboard">12.2. Installing and running Hystrix Dashboard</h3>
<div class="paragraph">
<p>The installation has been scripted: you need to run <code>tools/hystrix-dashboard/maven-package-deploy.bat</code>.</p>
</div>
<div class="paragraph">
<p>The current installation will re-package the 1.3.16 version of Hystrix dashboard and add to it the latest (yet unreleased) changes to allow running it without an internet connection. Please have a look into <code>pom.xml</code> to see how you can adopt an already packaged WAR file to your environment.</p>
</div>
<div class="paragraph">
<p>Open your browser on <a href="http://localhost:8080/hystrix-dashboard/" class="bare">http://localhost:8080/hystrix-dashboard/</a>. Press <b class="button">Monitor Stream</b> with the default setting to display the aggregated stream from the Turbine dashboard.</p>
</div>
<div class="paragraph">
<p>Enter <code><a href="http://localhost:8080/hystrixapp/hystrix.stream" class="bare">http://localhost:8080/hystrixapp/hystrix.stream</a></code> to retrieve the information from the application directly.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_behaviour_of_hystrix_under_load">13. Behaviour of Hystrix under load</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_introduction_to_load_scenarios_for_hystrix">13.1. Introduction to Load Scenarios for Hystrix</h3>
<div class="paragraph">
<p>Now we have a complete setup: an application, a driver for the load and a real time dashboard. You are now ready to see the behaviour of Hystrix.</p>
</div>
<div class="paragraph">
<p>The number of threads in JMeter will remain constant for all scenarios. The scenarios will differ only in their setting of <code>hystrixdemo.sleep</code> in <code>archaius.properties</code>. This will simulate an IBAN/BIC validation that is gradually getting slower and slower.</p>
</div>
<div class="paragraph">
<p>The delay between requests in the thread pool is 1 second. The time of the service to respond is not compensated by the delay: The longer the response time is, the fewer requests per second we will see. When there is no delay at all, we would see 20 requests per second, as we have 20 workers.</p>
</div>
</div>
<div class="sect2">
<h3 id="_a_fast_response_10_ms">13.2. A fast response: 10 ms</h3>
<div class="paragraph">
<p>Starting with a response time of 10 ms we see a very well behaving system: The throughput is about 18 requests per second.</p>
</div>
<div class="paragraph">
<p>The number of active threads is idling between one and two. The median service time is about 10 ms, the mean slightly above.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="manual/dashboard_10ms.png" alt="Hystrix Dashboard: 10 ms service delay">
</div>
<div class="title">Figure 3. Hystrix Dashboard: 10 ms service delay</div>
</div>
</div>
<div class="sect2">
<h3 id="_a_medium_response_70_ms">13.3. A medium response: 70 ms</h3>
<div class="paragraph">
<p>Now change the delay to 70 ms. Save the file. Archaius will pick up the new value within a second. Our IBAN/BIC service will get slower.</p>
</div>
<div class="paragraph">
<p>You will see an immediate effect on the Dashboard. After a short time the values in the dashboard will be re-calculated.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="manual/dashboard_70ms.png" alt="Hystrix Dashboard: 70 ms service delay">
</div>
<div class="title">Figure 4. Hystrix Dashboard: 70 ms service delay</div>
</div>
<div class="paragraph">
<p>With 13.6 requests per second and a delay of 70 ms in the service is now saturated. 13.7 req/s multiplied with 70 ms is almost 1 second working time per second.</p>
</div>
<div class="paragraph">
<p>You also see that the number of active threads has increased to 6.</p>
</div>
</div>
<div class="sect2">
<h3 id="_a_late_response_100_ms">13.4. A late response: 100 ms</h3>
<div class="paragraph">
<p>Change the delay to 100 ms. Save the file. You&#8217;ll see the dashboard change.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="manual/dashboard_100ms.png" alt="Hystrix Dashboard: 100 ms service delay">
</div>
<div class="title">Figure 5. Hystrix Dashboard: 100 ms service delay</div>
</div>
<div class="paragraph">
<p>The number of active threads iterates between 9 and 10. (Please ignore the "queue size", this is not active as queueing is disabled by default). Indicated as a yellow number some requests receive a time out while they are waiting at the synchronized lock on the simulated IBAN server. Purple indicates the number of requests that are rejected when there is no space in the queue.</p>
</div>
<div class="paragraph">
<p>The dashboard shows you that 26 percent of all requests fail.</p>
</div>
<div class="paragraph">
<p>If the service wouldn&#8217;t have been wrapped as a service, we would see an overload situation and with long response times. With Hystrix the response times in the 99 percent tier are still around one second for the successful requests.</p>
</div>
<div class="paragraph">
<p>The circuit is closed, meaning that Hystrix considers the service to be functional (although some requests are rejected).</p>
</div>
</div>
<div class="sect2">
<h3 id="_a_critical_response_200_ms">13.5. A critical response: 200 ms</h3>
<div class="paragraph">
<p>Now try 200 ms. Save the file. The dashboard will change again.</p>
</div>
<div class="paragraph">
<p>You&#8217;ll see that the Circuit changes between open and closed. Therefore the following picture is a combination of two screen shots.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="manual/dashboard_200ms.png" alt="Hystrix Dashboard: 200 ms service delay">
</div>
<div class="title">Figure 6. Hystrix Dashboard: 200 ms service delay</div>
</div>
<div class="paragraph">
<p>The ratio of failed commands is now more than 50 percent, therefore the circuit breaker kicks in. Every five seconds it tries on request (that is answered within 200 ms), resets the statistics and then closes again.</p>
</div>
<div class="paragraph">
<p>As the statistics are reset on each opening circuit, you can&#8217;t trust the dashboard. Please have a look in JMeter in the Summary report. Reset it (as it will by now contain results from the previous setups) and wait a short time. It will show you that about 65 percent of the requests fail.</p>
</div>
</div>
<div class="sect2">
<h3 id="_an_eternity_1500_ms">13.6. An eternity: 1500 ms</h3>
<div class="paragraph">
<p>The final setting: 1500 ms. Save the file. Watch the dashboard.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="manual/dashboard_1500ms.png" alt="Hystrix Dashboard: 1500 ms service delay">
</div>
<div class="title">Figure 7. Hystrix Dashboard: 1500 ms service delay</div>
</div>
<div class="paragraph">
<p>As the time out is 1000 ms for the commands, 100 percent of the requests fail. The circuit is now permanently open. Even the retry every 5 seconds will not close it again as this single request is too slow.</p>
</div>
</div>
<div class="sect2">
<h3 id="_hystrix_don_t_waste_resources_by_queueing_requests">13.7. Hystrix: Don&#8217;t waste resources by queueing requests</h3>
<div class="paragraph">
<p>The examples show that Hystrix does its job very effectively:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>It  will forward as many requests as possible to the service to process them.</p>
</li>
<li>
<p>Any other requests are returned to the sender as unsuccessful as early as possible.</p>
</li>
<li>
<p>No caller waits longer than the 1 second time out for a response.</p>
</li>
<li>
<p>Queues require resources and Hystrix efficiently minimizes queueing inside the system. It is limited by default to ten concurrent requests processed by the thread pool.</p>
</li>
<li>
<p>A burst in requests is reflected at the earliest boundary instead of overloading the backend service.</p>
</li>
<li>
<p>When the back end services are overloaded for one or the other reason, the circuit breaker in front will give the backend services a break to recover.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Well done, Hystrix!</p>
</div>
<div class="paragraph">
<p>Please feel free to try your own variations: enable queueing, change the number of threads, or try out any other Hystrix setting.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_long_term_monitoring_of_hystrix_metrics">14. Long term monitoring of Hystrix metrics</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_zabbix_as_classic_long_term_monitoring_and_notification">14.1. Zabbix as classic long term monitoring and notification</h3>
<div class="paragraph">
<p><a href="http://zabbix.com/" target="_blank">Zabbix</a> is a classic monitoring system. It is stable and it has grown over several iterations. It supports a REST API out of the box.</p>
</div>
<div class="paragraph">
<p>All data is stored in a database. The server polls information from clients, runs commands or receives information from agents.</p>
</div>
<div class="paragraph">
<p>A frontend service will provide a web interface that includes configuration, monitoring and graphing capabilities.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installing_and_running_zabbix">14.2. Installing and running Zabbix</h3>
<div class="paragraph">
<p>The installation has been scripted as a <a href="http://vagrantup.com" target="_blank">Vagrant</a> script. This will first download a linux image of CentOS and spin it up in <a href="http://virtualbox.org/" target="_blank">Virtualbox</a>. Then it will hand over to a provisioner, in our case this is <a href="http://saltstack.com/" target="_blank">Saltstack</a>.</p>
</div>
<div class="paragraph">
<p>To install Vagrant please see <a href="#vagrant">Running virtual machines for test and development</a>. Once it is installed,
run the follwing command in <code>tools/zabbix</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>vagrant up</pre>
</div>
</div>
<div class="paragraph">
<p>This will take a while to download all the files necessary. Once it is up and running point your browser at your local Zabbix installation: <a href="http://localhost:2280/" class="bare">http://localhost:2280/</a>.</p>
</div>
<div class="paragraph">
<p>Use Username <code>Admin</code> password <code>zabbix</code> to log in (please not the capital <strong>A</strong> in the user name)</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_of_zabbix">14.3. Configuration of Zabbix</h3>
<div class="paragraph">
<p>All configuration items could be automated using the REST API. This will be a future task for this tutorial.</p>
</div>
<div class="paragraph">
<p>For now these are the manual steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In <span class="menuseq"><span class="menu">Configuration</span>&#160;&#9656; <span class="menuitem">Host</span></span> click on <b class="button">Create Host</b>. Enter <code>hystrix</code> as host name here. Pick <code>Discovered Hosts</code> as the Host group. Now <b class="button">Save</b>.</p>
</li>
<li>
<p>In <span class="menuseq"><span class="menu">Configuration</span>&#160;&#9656; <span class="menuitem">Templates</span></span> click on <b class="button">Import</b>. Pick the file <code>hystrix_template.xml</code> from <code>tools\zabbix</code>. Click on <b class="button">Import</b>.</p>
</li>
<li>
<p>Choose <span class="menuseq"><span class="menu">Configuration</span>&#160;&#9656; <span class="menuitem">Templates</span></span> again. You see a <code>hystrixTemplate</code> here. Click on this template to edit it. Include the host <code>hystrix</code> in group <code>Discovered Hosts</code> in the shuttle view to put it on the left side. This will apply the template to the host. Click on <b class="button">Save</b>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This is all configuration that is needed: You have created a host, and you have associated it with a template that will autodiscover all Hystrix comamnds.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_of_the_example_application">14.4. Configuration of the example application</h3>
<div class="paragraph">
<p>As default the Zabbix agent in the application is disabled. To enable it, go to the file <code>archaius.properties</code>. Change the <code>hystrixdemo.enablezabbix</code> to be true.</p>
</div>
<div class="paragraph">
<p>The change is active at runtime. This will trigger the activation in <code>HystrixSetupListener</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_zabbix_autodiscovery_at_work">14.5. Zabbix autodiscovery at work</h3>
<div class="paragraph">
<p>The following steps will now happen automatically:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The Zabbix agent will connect to <code>127.0.0.1:10051</code> and identifies itself as host <code>hystrix</code>. In our example this is hardcoded.</p>
</li>
<li>
<p>The Zabbix agent asks the server for any scheduled checks. The only check that is configured for the host <code>hystrix</code> is the <code>hystrixCommand.discovery</code> in the template.</p>
</li>
<li>
<p>The agent runs the check and delivers all active Hystrix commands as a JSON object to the server.</p>
</li>
<li>
<p>This will trigger the auto discovery. For every command Zabbix will create 20 items and three graphs.</p>
</li>
<li>
<p>When the Zabbix agent reloads the list of checks after a minute, there will be a lot more checks. It will run them as specified in the interval of the template we imported to Zabbix.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The auto discovery rule is set to run every five seconds. Please note that the auto discovery will only find commands that have been triggered at least once during the runtime of the application. Hystrix will only notify our Zabbix agent at the first created command.</p>
</div>
<div class="paragraph">
<p>Please choose <span class="menuseq"><span class="menu">Configuration</span>&#160;&#9656; <span class="menuitem">Hosts</span></span> and you should see the number of Items change for the host <code>hystrix</code>. Please refresh your browser if necessary.</p>
</div>
<div class="paragraph">
<p>Now choose <span class="menuseq"><span class="menu">Monitoring</span>&#160;&#9656; <span class="menuitem">Graphs</span></span> and choose the host <code>hystrix</code> and any of the three graphs. After a few minutes you should see the first graphs appearing. The following screen shows a service that was answering successfully first. After a short time the response time was changed to 250 ms. Soon lots of rejected and timeout requests appear.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="manual/requestcount_zabbix.png" alt="Zabbix counting Hystrix requests">
</div>
<div class="title">Figure 8. Zabbix counting Hystrix requests</div>
</div>
<div class="paragraph">
<p>Zabbix polls for the command data every minute. Change the timing in <code>archaius.properties</code> to see information about failed requests.</p>
</div>
<div class="paragraph">
<p>Click on <span class="menuseq"><span class="menu">Monitoring</span>&#160;&#9656; <span class="menuitem">Latest data</span></span> to see the latest values that the agent has sent.</p>
</div>
</div>
<div class="sect2">
<h3 id="_java_classes_to_forward_information_from_hystrix_to_zabbix">14.6. Java classes to forward information from Hystrix to Zabbix</h3>
<div class="paragraph">
<p>In order to activate the forwarding of events, you&#8217;ll need to change <code>hystrixdemo.enablezabbix</code> to <code>true</code> in <code>archaius.properties</code>.
This change will be active immediately.</p>
</div>
<div class="paragraph">
<p>The property <code>hystrixdemo.enablezabbix</code> in <code>archaius.properties</code> is evaluated in the class <code>HystrixSetupListener</code>. When this property is enabled, the Zabbix agent is started.</p>
</div>
<div class="paragraph">
<p>You find all additional classes in the package <code>de.ahus1.hystrix.util.zabbix</code> in the example application. The following classes work together to forward the information to Zabbix:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>ZabbixCommandMetricsProvider</code> is registered with Zabbix. It handles the connection to Zabbix. It creates a callback <code>ZabbixCommandMetricsProvider</code> that will be called by the agent when it requires data for the provider <code>hystrixCommand</code>. It creates for Zabbix on request a <code>HystrixZabbixMetricsPublisherCommand</code> when a command is created for the first time.</p>
</li>
<li>
<p>Once the <code>HystrixZabbixMetricsPublisherCommand</code> initialized, it registers itself with the <code>ZabbixCommandMetricsProvider</code>.</p>
</li>
<li>
<p>The <code>ZabbixCommandMetricsProvider</code> will provide a list of HystrixCommand keys when it is called with <code>hystrixCommand.discovery</code> When it is called <code>hystrixCommand.countSuccess[{#COMMAND}]</code> it returns the current count of successful Hystrix command calls.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The current implementation doesn&#8217;t return any information about thread pools yet.</p>
</div>
</div>
<div class="sect2">
<h3 id="_working_with_templates_in_zabbix">14.7. Working with templates in Zabbix</h3>
<div class="paragraph">
<p>When you change your template, the changes are applied to all hosts assigned to the template. This makes it easy to ensure a common configuration of all Hystrix commands throughout your infrastructure.</p>
</div>
<div class="paragraph">
<p>You can also choose to setup triggers automatically.</p>
</div>
<div class="paragraph">
<p>When a command is no longer used in your application, the auto discovery will no longer return it to Hystrix. Hystrix will remove all items that are no longer needed after 30 days. You can simulate this behaviour by stopping/starting the tomcat server and not sending any requests via JMeter. As now commands will be triggered, the list of auto-discovered commands is empty. A few seconds later Zabbix will add a yellow exclamation mark to your items and will start the 30 day countdown.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_real_time_monitoring_of_hystrix_metrics">15. Real time monitoring of Hystrix metrics</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_riemann_as_cutting_edge_realtime_event_processing">15.1. Riemann as cutting edge realtime event processing</h3>
<div class="paragraph">
<p><a href="http://www.riemann.io/" target="_blank">Riemann</a> is a a modern event management system. It has been designed with with performance in mind for montoring complex systems. To process the data fast it keeps the last few minutes of data in memory. All events are processed in a streaming mode.</p>
</div>
<div class="paragraph">
<p>The events can be aggregated and filtered. You can also start actions like notifying IT operations of problems.</p>
</div>
<div class="paragraph">
<p>Riemann comes with its own dashboard that can show you can use to show real time graphs and statistics.</p>
</div>
<div class="paragraph">
<p>So far both the Hystrix Dashboard and Zabbix have been presented. You could consider Riemann for the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Zabbix polls existing metrics from Hystrix. You can aggregate events to deliver your own metrics using Riemann. This all happens outside of the application. This gives you a lot of flexibility.</p>
</li>
<li>
<p>While the Hystrix Dashboard is a great start for a dashboard, it is not configurable.  The Riemann Dashboard is highly configurable (once you understand its keyboard shortcuts) and might delivery you additional insights you might need to administer your cluster.</p>
</li>
<li>
<p>Assuming that Zabbix receives information every minute, this  means that you will receive alerts with a delay of one minute. After a problem disappeared (for example after you have restarted a service, or fixed a configuration problem) you will see this only after a minute or two in the Zabbix graphs. Riemann gives you the options to be notified immediately by a channel of your choice (email, SMS, chat) when the problem occurs and when it is fixed.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Filtered events can be forwarded to systems like InfluxDB to be stored. These can be displayed later using tools like Grafana. But lets start with Riemann first.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installing_and_running_riemann">15.2. Installing and running Riemann</h3>
<div class="paragraph">
<p>The installation has been scripted as a <a href="http://vagrantup.com" target="_blank">Vagrant</a> script. This will first download a linux image of CentOS and spin it up in <a href="http://virtualbox.org/" target="_blank">Virtualbox</a>. Then it will hand over to a provisioner, in our case this is <a href="http://saltstack.com/" target="_blank">Saltstack</a>.</p>
</div>
<div class="paragraph">
<p>To install Vagrant please see <a href="#vagrant">Running virtual machines for test and development</a>. Once it is installed,
run the follwing command in <code>tools/riemann</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>vagrant up</pre>
</div>
</div>
<div class="paragraph">
<p>This will take a while to download all the files necessary. Once it is up and running point your browser at your local Riemann installation: <a href="http://localhost:4567/" class="bare">http://localhost:4567/</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_events_are_captures_for_riemann">15.3. How Events are captures for Riemann</h3>
<div class="paragraph">
<p>In the example application the <code>HystrixSetupListener</code> registers the class <code>HystrixRiemannEventNotifier</code> with Hystrix. This will be notified with the detailed timinings of each run command and with the outcome of each command (successful, timeout, etc.).</p>
</div>
<div class="paragraph">
<p>These events are queued in a bounded queue. The result will be forwarded to Riemann in batches every 100 ms.</p>
</div>
<div class="paragraph">
<p>In order to activate the forwarding of events, you&#8217;ll need to change <code>hystrixdemo.enableriemann</code> to <code>true</code> in <code>archaius.properties</code>.
This change will be active immediately.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_riemann_server">15.4. Configuring Riemann Server</h3>
<div class="paragraph">
<p>In this setup the information about Hystrix commands is forwarded on a level of a single command execution.</p>
</div>
<div class="paragraph">
<p>We can present it on this level, but usually you want to create aggreation on top of the event stream. The first listing aggregates  the timings of the service <code>IBANValidatorCommand</code>.</p>
</div>
<div class="listingblock">
<div class="title">Percentiles with riemann.config</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="closure">(let [index (index)]
  (streams
    (where (and (= service &quot;IBANValidatorCommand&quot;) (not (= metric nil)) )

       ; Now, we'll calculate the 50th, 95th, and 99th percentile for all
       ; requests in each 5-second interval.

       (percentiles 5 [0.5 0.95 0.99]

           ; Percentiles will emit events like
           ; {:service &quot;api req 0.5&quot; :metric 0.12}
                   ; We'll add them to the index, so they can show up
           ; on our dashboard.

           index)
    )
  )
)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The second listing counts the different outcomes (SUCCESS, TIMEOUT, etc.) in every five second interval. This statement contains a statement for logging the aggregated events in the Riemann server log.</p>
</div>
<div class="listingblock">
<div class="title">Counting with riemann.config</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="closure">(let [index (index)]
  (streams
    (where (and (= service &quot;IBANValidatorCommand&quot;) (= metric nil) )

      (by :state
        (with :metric 1 (with :service &quot;IBAN Count&quot;
          (rate 5
          ; log all events (for debugging)
          #(info &quot;received event&quot; %)
            index
          )
        ))
      )

    )
  )
)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_riemann_dashboard">15.5. Configuring Riemann Dashboard</h3>
<div class="paragraph">
<p>You can configure the frontend of Riemann in your browser. This setup installs a dashboard that shows some useful information about the example application.</p>
</div>
<div id="img-riemanndashboard" class="imageblock">
<div class="content">
<img src="manual/riemann_dashboard.png" alt="Riemann Dashboard">
</div>
<div class="title">Figure 9. Riemann Dashboard</div>
</div>
<div class="paragraph">
<p>In the lower part of the screen you will see a guide how to use keyboard shortcuts to customize the dashboard.</p>
</div>
<div class="paragraph">
<p>As with the Zabbix monitoring, this will only show useful information once some commands are run. Please use the JMeter load test for this.</p>
</div>
</div>
</div>
</div>
<h1 id="_appendix" class="sect0">Appendix</h1>
<div class="sect1">
<h2 id="asciidoctor">16. Writing an online manual</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_asciidoctor_is_a_lean_tool_for_technical_documentation">16.1. Asciidoctor is a lean tool for technical documentation</h3>
<div class="paragraph">
<p>This manual is written in Asciidoc format. Asciidoctor is used to create an online documentation from it.</p>
</div>
<div class="paragraph">
<p>To find out more about Asciidoctor see the <a href="http://asciidoctor.org/" class="bare">http://asciidoctor.org/</a>.  It is a clone of the original Asciidoc using Ruby. Compiled versions are available for Java and JavaScript. This allows you to easily integrate it into your build process.</p>
</div>
<div class="paragraph">
<p>You can create from a single source of documentation formats like HTML5, PDF and epub.</p>
</div>
</div>
<div class="sect2">
<h3 id="_editors_to_work_on_asciidoctor">16.2. Editors to work on Asciidoctor</h3>
<div class="paragraph">
<p>Asciidoctor files are plain text files with an easy to learn syntax. You can use any text editor to write the files.</p>
</div>
<div class="paragraph">
<p>You might want to try the <a href="https://github.com/asciidoctor/atom-asciidoc-preview" target="_blank">Asciidoctor preview plugin</a> and <a href="https://atom.io/packages/language-asciidoc" target="_blank">Asciidoctor language plugin</a> for <a href="https://atom.io/" target="_blank">GitHub&#8217;s Atom</a> editor. As the time of writing this provides you the best authoring experience.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="vagrant">17. Running virtual machines for test and development</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_vagrant_manages_virtual_machines">17.1. Vagrant manages virtual machines</h3>
<div class="paragraph">
<p>Virtual machines make development and test easier, as they can be started and stoped as you need them. You re-use the CPU, RAM and hard disk space on your PC. When you don&#8217;t need them you shut them down and they will use only some hard drive space. Once your test or development are over you can wipe them from your hard disk.</p>
</div>
<div class="paragraph">
<p>A software to provide this virtualization is the free <a href="http://virtualbox.org/" target="_blank">Oracle&#8217;s Virtualbox</a>. You can spin up as many machines as you have RAM, CPU and hard disk space on your local machine. You can set up custom networking and interact with the machines either via screen or network.</p>
</div>
<div class="paragraph">
<p>But setting up a test environment would still be a manual process if you would use only Virtualbox. <a href="http://vagrantup.com" target="_blank">Vagrant</a> builds on top of it and provides a command line and scripting for you. It also allows you to create local test instances from centrally managed ready made boxes, so you don&#8217;t need to install an operating system manually.</p>
</div>
</div>
<div class="sect2">
<h3 id="_installing_vagrant_and_useful_plugins">17.2. Installing Vagrant and useful plugins</h3>
<div class="paragraph">
<p>To use Vagrant please use the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download and install Oracle&#8217;s Virtualbox from <a href="http://virtualbox.org/" class="bare">http://virtualbox.org/</a>.</p>
</li>
<li>
<p>Download and install Hashicorp&#8217;s Vagrant from <a href="http://vagrantup.com" class="bare">http://vagrantup.com</a>.</p>
</li>
<li>
<p>Install the Vagrant Cachier Plugin (<a href="https://github.com/fgrehm/vagrant-cachier" class="bare">https://github.com/fgrehm/vagrant-cachier</a>) to cache all downloaded  software packages locally. This will speed up future installations. Do this by starting from the command line:</p>
<div class="literalblock">
<div class="content">
<pre>vagrant plugin install vagrant-cachier</pre>
</div>
</div>
</li>
<li>
<p>Install the Vagrant Guest Additions Plugin  (<a href="https://github.com/dotless-de/vagrant-vbguest" class="bare">https://github.com/dotless-de/vagrant-vbguest</a>) to be able to update the virtual box tools on the downloaded images automatically. Do this by starting from the command line:</p>
<div class="literalblock">
<div class="content">
<pre>vagrant plugin install vagrant-vbguest</pre>
</div>
</div>
</li>
<li>
<p>Install the Vagrant proxy plugin  (<a href="https://github.com/tmatilai/vagrant-proxyconf" class="bare">https://github.com/tmatilai/vagrant-proxyconf</a>) to configure the downloaded image automatically regarding its proxy settings. Do this by starting from the command line</p>
<div class="literalblock">
<div class="content">
<pre>vagrant plugin install vagrant-proxyconf</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_proxy_configuration_for_vagrant">17.3. Proxy configuration for Vagrant</h3>
<div class="paragraph">
<p>To be able to install any vagrant plugin behind a proxy, set the <code>http_proxy</code> environment variable. The this syntax assumes you are running a Microsoft Windows system:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>SET HTTP_PROXY="http://username:password@proxyhost:proxyport/
SET HTTPS_PROXY="http://username:password@proxyhost:proxyport/</pre>
</div>
</div>
<div class="paragraph">
<p>Vagrant will not re-use your system&#8217;s proxy settings. You&#8217;ll need to specify them again.</p>
</div>
<div class="paragraph">
<p>I recommend that you set up a common configuration for all your boxes (not individually for each box). Create (or ammend) the file <code>Vagrantfile</code> in your <code>%USERPROFILE%\.vagrant.d</code> folder.</p>
</div>
<div class="listingblock">
<div class="title">Vagrantfile</div>
<div class="content">
<pre class="CodeRay highlight"><code># URI of the local (caching) HTTP proxy
# LOCAL_HTTP_PROXY = 'http://proxyhost:proxyport'
LOCAL_HTTP_PROXY =

# Configures vagrant-cachier and vagrant-proxyconf.
# Should be called only on "local machine" providers.
def configure_caching(config)
  if Vagrant.has_plugin?('vagrant-cachier')
    config.cache.enable :gem
    config.cache.enable :npm
  end

  if Vagrant.has_plugin?('vagrant-proxyconf')
    config.proxy.http     = LOCAL_HTTP_PROXY
    config.proxy.https    = LOCAL_HTTP_PROXY
    config.proxy.no_proxy = 'localhost,127.0.0.1'
  end
end

Vagrant.configure('2') do |config|
  config.vm.provider :virtualbox do |vbox, override|
    configure_caching(override)
  end
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can set the environment variables <code>VAGRANT_HTTP_PROXY</code>, <code>VAGRANT_HTTPS_PROXY</code> and <code>VAGRANT_NO_PROXY</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_managing_virtual_machines_from_the_command_line">17.4. Managing virtual machines from the command line</h3>
<div class="paragraph">
<p>You can start a box with:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>vagrant up</pre>
</div>
</div>
<div class="paragraph">
<p>You can stop a box with:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>vagrant suspend</pre>
</div>
</div>
<div class="paragraph">
<p>You can log in to the box using:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>vagrant ssh</pre>
</div>
</div>
<div class="paragraph">
<p>For a list of other commands start</p>
</div>
<div class="literalblock">
<div class="content">
<pre>vagrant -h</pre>
</div>
</div>
<div class="paragraph">
<p>By default a user <code>vagrant</code> with password <code>vagrant</code> exists every machine. You can use <code>ssh</code> to access a console. From the <code>vagrant</code> user you can use the <code>sudo</code> command to acquire root access.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="saltstack">18. Automatic provisioning of machines</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_saltstack_installation_automation">18.1. Saltstack installation automation</h3>
<div class="paragraph">
<p>In order to provide reproducable and easy to setup development and test environments, you can script the installation of the software.</p>
</div>
<div class="paragraph">
<p>There are different tools available to install and configure software once the base operating system is installed. Some of the tools used for this are Chef, Puppet, Saltstack and Ansible.</p>
</div>
<div class="paragraph">
<p>I&#8217;ve chosen Saltstack here as it concentrates on its task to install and configure software - nothing more. For this it takes input as simple YAML files with only very little scripting.</p>
</div>
<div class="paragraph">
<p>Vagrant already knowns about different provisioners, also about Saltstack. To hand over control to Saltstack only the following few lines are necessary in the <code>Vagrantfile</code> of the virtual machine you want to provision:</p>
</div>
<div class="listingblock">
<div class="title">Vagrantfile</div>
<div class="content">
<pre class="CodeRay highlight"><code>config.vm.provision :salt do |salt|
  salt.minion_config = "salt/minion"
  salt.run_highstate = true
end</code></pre>
</div>
</div>
<div class="paragraph">
<p>Vagrant will first check if Saltstack is already installed on the virtual machine. If not, it will install the latest version of Saltstack. Once this is complete it hands over control to Saltstack to install all the configured packages.</p>
</div>
<div class="paragraph">
<p>To find out more about Saltstack please visit its website <a href="http://saltstack.com" class="bare">http://saltstack.com</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_running_saltstack_in_standalone_mode">18.2. Running Saltstack in standalone mode</h3>
<div class="paragraph">
<p>Saltstack can be run in two modes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Centrally managed configuration</strong>: a master server stores all configuration and passes it to the clients (the clients are called "minions").</p>
</li>
<li>
<p><strong>Locally stored configuration</strong>: A client will have all configuration files necessary stored locally. This setup is called "masterless" setup.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The scripts will not differ in the two setups. But it simlifies development and also the setup we use here to have a masterless setup. To do this, I specied <code>file_client: local</code> in the <code>minion</code> file.</p>
</div>
<div class="paragraph">
<p>(Note: this masterless setup is not unique to Saltstack, it is also available for other provisioning tools.)</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_files_for_automatic_installation">18.3. Configuration files for automatic installation</h3>
<div class="paragraph">
<p>You will find the configuration files in <code>salt/roots/salt</code>. They are plain text files. You can open them in a plain text editor to get a first impression. Please refer to the Salstack documentation find out more.</p>
</div>
</div>
<div class="sect2">
<h3 id="_saltstack_commands">18.4. Saltstack commands</h3>
<div class="paragraph">
<p>Provisioning via saltstack is run automatically. To run salt stack provisioning manually again (for example after you have changed a configuration file) use the following command as user <code>root</code>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>salt-call --local state.highstate</pre>
</div>
</div>
<div class="paragraph">
<p>Please refer to the Salstack documentation find out more.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_building_the_documentation_automatically">19. Building the documentation automatically</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_things_that_need_maintenance">19.1. Things that need maintenance</h3>
<div class="paragraph">
<p>This manual is written in Asciidoc format. Asciidoctor is used to create an online documentation from it.</p>
</div>
<div class="paragraph">
<p>This can be done manually by calling <code>manual/build.bat</code>. The changes then need to be published to the <code>gh-pages</code> branch.</p>
</div>
<div class="paragraph">
<p>To find out more about Asciidoc and Asciidoctor see see section <a href="#asciidoctor">Writing an online manual</a>. To find out more about GitHub Pages see <a href="https://pages.github.com/" class="bare">https://pages.github.com/</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_travis_ci_as_a_service_in_the_cloud">19.2. Travis CI as a service in the cloud</h3>
<div class="paragraph">
<p>Travis CI is a build service in the clould that is free to all open source projects. It integrates well with GitHub. A new build is triggered on every push to your repository.</p>
</div>
<div class="paragraph">
<p>The following bit&#8217;s and pieces are needed:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Hook up <a href="http://travis-ci.org/" class="bare">http://travis-ci.org/</a> to your repository.</p>
</li>
<li>
<p>Add a file <code>.travis.yml</code> to the root of the repository. In our case this indicates to Travis that we want to use Ruby.</p>
</li>
<li>
<p>Add a file <code>Gemfile</code> to the root of the repository to specify the dependencies of Asciidoctor.</p>
</li>
<li>
<p>Add a file <code>manual/build.sh</code> to the project to copy images in the proper place, and run asciidoctor.</p>
</li>
<li>
<p>Add a file <code>manual/update-gh-pages.sh</code> to store the created Asciidoctor output to the repositories GitHub pages branch.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can see the current status of the build here: <a href="https://travis-ci.org/ahus1/hystrix-examples" class="bare">https://travis-ci.org/ahus1/hystrix-examples</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-03-09 11:26:34 UTC
</div>
</div>
</body>
</html>